<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>app/index.js</title>
    <link rel="stylesheet" href="http://yui.yahooapis.com/3.9.1/build/cssgrids/cssgrids-min.css">
    <link rel="stylesheet" href="../assets/vendor/prettify/prettify-min.css">
    <link rel="stylesheet" href="../assets/css/main.css" id="site_styles">
    <link rel="icon" href="../assets/favicon.ico">
    <script src="http://yui.yahooapis.com/combo?3.9.1/build/yui/yui-min.js"></script>
</head>
<body class="yui3-skin-sam">

<div id="doc">
    <div id="hd" class="yui3-g header">
        <div class="yui3-u-3-4">
                <h1><img src="../assets/css/logo.png" title="" width="117" height="52"></h1>
        </div>
        <div class="yui3-u-1-4 version">
            <em>API Docs for: </em>
        </div>
    </div>
    <div id="bd" class="yui3-g">

        <div class="yui3-u-1-4">
            <div id="docs-sidebar" class="sidebar apidocs">
                <div id="api-list">
                    <h2 class="off-left">APIs</h2>
                    <div id="api-tabview" class="tabview">
                        <ul class="tabs">
                            <li><a href="#api-classes">Classes</a></li>
                            <li><a href="#api-modules">Modules</a></li>
                        </ul>
                
                        <div id="api-tabview-filter">
                            <input type="search" id="api-filter" placeholder="Type to filter APIs">
                        </div>
                
                        <div id="api-tabview-panel">
                            <ul id="api-classes" class="apis classes">
                                <li><a href="../classes/Main.html">Main</a></li>
                            </ul>
                
                            <ul id="api-modules" class="apis modules">
                                <li><a href="../modules/configuring.html">configuring</a></li>
                                <li><a href="../modules/initializing.html">initializing</a></li>
                                <li><a href="../modules/install.html">install</a></li>
                                <li><a href="../modules/mainModuleYoctoStackGenerator.html">mainModuleYoctoStackGenerator</a></li>
                                <li><a href="../modules/prompting.html">prompting</a></li>
                                <li><a href="../modules/writing.html">writing</a></li>
                            </ul>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <div class="yui3-u-3-4">
                <div id="api-options">
                    Show:
                    <label for="api-show-inherited">
                        <input type="checkbox" id="api-show-inherited" checked>
                        Inherited
                    </label>
            
                    <label for="api-show-protected">
                        <input type="checkbox" id="api-show-protected">
                        Protected
                    </label>
            
                    <label for="api-show-private">
                        <input type="checkbox" id="api-show-private">
                        Private
                    </label>
                    <label for="api-show-deprecated">
                        <input type="checkbox" id="api-show-deprecated">
                        Deprecated
                    </label>
            
                </div>
            
            <div class="apidocs">
                <div id="docs-main">
                    <div class="content">
<h1 class="file-heading">File: app/index.js</h1>

<div class="file">
    <pre class="code prettyprint linenums">
/**
 * Main file of the &#x27;yocto-stack-generator&#x27;
 *
 * @class Main
 * @date 14/04/2015
 * @author CÃ©dric Balard
 * @copyright Yocto SAS &lt;http://www.yocto&gt;
 */

&#x27;use strict&#x27;;
var yeoman  = require(&#x27;yeoman-generator&#x27;);
var mkdirp  = require(&#x27;mkdirp&#x27;);
var _       = require(&#x27;lodash&#x27;);
var winston  = require(&#x27;winston&#x27;);


 var logger = new (winston.Logger)( {
    transports: [
      new (winston.transports.Console)( {
          colorize : true
          }),
      ]
  });

var npmDependenciesFile = require(&#x27;./config/dependencies.json&#x27;);
logger.info(&#x27;List of Npm Dependencies : loaded &#x27;);

/**
 *We extend a parent generator of yeoman to create our own generator
 *
 * @module mainModuleYoctoStackGenerator
 * @main
 */
module.exports = yeoman.generators.Base.extend({

    /**
     * Initializing, load .json config files
     *
     * @submodule initializing
     */
    initializing : {
        /**
         * Read &quot;./config/folders.json&quot; and get all folders
         *
         * @method getPathFoldrers
         * @param
         * @return
         */
        getPathFoldrers : function() {
            this.pathFolders = require(&#x27;./config/folders.json&#x27;);
            logger.info(&#x27;Folders list to create : loaded &#x27;);
        },

        /**
         * Read &quot;dependencies.json&quot; and get all dependencies
         * @method getNpmDependencies
         */
        getNpmDependencies : function() {
            this.listNpmDependencies = [];
            _.forEach( npmDependenciesFile.required, function(dep) {
                this.listNpmDependencies.push(dep.dependencies);
            }, this );
        },

        /**
         * Read &quot;dependencies.json&quot; and get all optional dependencies
         *
         * @method getNpmDependenciesOptional
         */
        getNpmDependenciesOptional : function() {
            this.listNpmDependenciesOptional = [];
            _.forEach( npmDependenciesFile.optional, function(dep) {
                if (_.isString(dep.dependencies) )
                    this.listNpmDependenciesOptional.push( dep.dependencies);
                else
                    this.listNpmDependenciesOptional.push(  _([dep.dependencies.name, dep.dependencies.version]).join(&quot;@&quot;));

            }, this );
        },

        /**
         * Read &quot;dependencies.json&quot; and get different type of DB
         *
         * @method getDBConfig
         */
        getDBConfig : function() {
            this.dbConfigPossibles = [];
            _.forEach( npmDependenciesFile.db, function(db) {
                this.dbConfigPossibles.push(db.type);
            }, this );
        }
    },

    /**
     * Handle user intereactions
     *
     * @submodule prompting
     */
    prompting : {
        /**
         * Ask user about general project&#x27;s info :
         * 		- Name
         * 		- Description
         * 		- Version
         * 		- If is private
         *
         * @method promptInfoProject
         */
        promptInfoProject : function() {
            var done = this.async();
            var prompts = [{
                name        : &#x27;appName&#x27;,
                message     : &#x27;What is your app\&#x27;s name ?&#x27;,
                validate    : function(input){
                    if( input.length &gt;2 )
                        return true;
                    else
                        return &#x27;Please enter a valid application name (Min 3 Chars)&#x27;;
                }
            },

            {
                name        : &#x27;appDescription&#x27;,
                message     : &#x27;What is your app\&#x27;s desription ?&#x27;,
                validate    : function(input) {
                    if( input.length &gt;9 )
                        return true;
                    else
                        return &#x27;Please enter a valid application description (Min 10 Chars)&#x27;;
                }
            },

            {
                name        : &#x27;appVersion&#x27;,
                message     : &#x27;What is your app\&#x27;s version (format x.x.x) ?&#x27;,
                default     : &#x27;0.1.0&#x27;,
                validate    : function(input) {
                    var reg = /^(\d+)\.(\d+)\.(\d+)$/;
                    if( reg.exec(input))
                        return true;
                    else
                        return false;
                }
            },

            {
                name    : &#x27;appIsPrivate&#x27;,
                type    : &#x27;list&#x27;,
                message : &#x27;Your app\&#x27;s is private ?&#x27;,
                choices : [&#x27;true&#x27;, &#x27;false&#x27;],
            }];

            this.prompt(prompts, function (props) {
                this.appName        = props.appName;
                this.appDescription = props.appDescription;
                this.appVersion     = props.appVersion;
                this.appIsPrivate   = props.appIsPrivate;
                done();
            }.bind(this));
        },

        /**
         * Ask user about wich npm dependencie optional he want install
         *
         * @method promptNpmDependenciesOptional
         */
        promptNpmDependenciesOptional : function() {
            if( ! _.isEmpty(this.listNpmDependenciesOptional) )
            {
                var done = this.async();
                var prompts = [{
                    type    : &#x27;checkbox&#x27;,
                    name    : &#x27;npmDepOption&#x27;,
                    message : &#x27;Select which dependencies you want to install (click on &quot;space&quot; for select/unselect) :&#x27;,
                    choices : this.listNpmDependenciesOptional
                }];

                this.prompt(prompts, function (props) {
                    _.forEach(props.npmDepOption, function(val){
                        this.listNpmDependencies.push(val);
                    }, this);
                    done();
                }.bind(this));
            }
        },

        /**
        * Ask user about wich type of database he want install
        *
        * @method promptDbChoices
         */
        promptDbChoices : function() {
            var done = this.async();
            var prompts = [{
                type    : &#x27;list&#x27;,
                name    : &#x27;npmDbChoice&#x27;,
                message : &#x27;Select which type of database you want to install :&#x27;,
                choices : this.dbConfigPossibles
            }];

            this.prompt(prompts, function (props) {
                    this.dbType=props.npmDbChoice;
                done();
            }.bind(this));
        }
    },

    /**
     * Handle configuration : make all directory ...
     *
     * @submodule configuring
     */
    configuring : {
        /**
         * Create all folders present in &quot;config/folders.json&quot;
         * Add &#x27;.gitignore&#x27; file in each created folder
         *
         * @method scaffoldFolders
         */
        scaffoldFolders : function() {
            _.forEach( this.pathFolders.folders, function(value) {
                mkdirp(value.path);
                logger.info( _([&#x27;New folder created :&#x27;, value.path]).join(&#x27; &#x27;) );
                this.copy(&#x27;_.gitignore&#x27;, _([value.path,&#x27;.gitignore&#x27;]).join(&#x27;/&#x27;) );

            }, this);
        },

        /**
         * Handle DB dependencies in correlation with the dbType choosen
         * Add specifics dependencies to install
         *
         * @method setDependenciesDB
         */
        setDependenciesDB : function() {
            _.forEach( npmDependenciesFile.db, function(db) {
                if(this.dbType === db.type )
                {
                    _.forEach(db.dependencies, function(dep) {
                        this.listNpmDependencies.push(dep);
                    } ,this )   ;
                }
            }, this );
        }
    },

    /**
     * Generate specifics files : package.json, routes...
     *
     * @submodule writing
     */
    writing : {
        /**
         *Generate files :
         *	 - gruntfile.js
         *	 - package.json
         *
         * @method generateAllFiles
         */
        generateAllFiles : function() {
            var context = {
                siteName            : this.appName,
                siteDescription     : this.appDescription,
                siteVersion         : this.appVersion,
                siteIsPrivate       : this.appIsPrivate
            };

            this.copy(&#x27;_gruntfile.js&#x27;, &#x27;Gruntfile.js&#x27;);
            this.template(&#x27;_package.json&#x27;, &#x27;package.json&#x27;, context);
        }
    },

    /**
     * Install all dependencies : npm and Bower
     *
     * @submodule install
     */
    install : {
        /**
         * Install all npm dependencies
         *
         * @method installNpmDependencies
         */
        installNpmDependencies : function() {
            this.log(&#x27;Install npm dependencies&#x27;);
            _.forEach(this.listNpmDependencies, function(dep) {
                if (_.isString(dep))
                {
                    this.npmInstall([dep], { &#x27;save&#x27;: true });
                    logger.info(&#x27;Package installed : &#x27; + dep );
                }
                else
                {
                    this.npmInstall( _([dep.name,dep.version]).join(&quot;@&quot;) );
                    logger.info(  _([&#x27;Package installed : &#x27;, dep.name, dep.version]).join(&quot;@&quot;) );
                }
            }, this);
        },

        /**
         * Install all bower dependencies
         *
         * @method installBowerDependencies
         */
        installBowerDependencies : function() {
        }
    }
});

    </pre>
</div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
<script src="../assets/vendor/prettify/prettify-min.js"></script>
<script>prettyPrint();</script>
<script src="../assets/js/yui-prettify.js"></script>
<script src="../assets/../api.js"></script>
<script src="../assets/js/api-filter.js"></script>
<script src="../assets/js/api-list.js"></script>
<script src="../assets/js/api-search.js"></script>
<script src="../assets/js/apidocs.js"></script>
</body>
</html>
